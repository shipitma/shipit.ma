(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1280],{1390:(e,s,a)=>{Promise.resolve().then(a.bind(a,9645))},7809:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},9645:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>A});var r=a(5155),t=a(2115),l=a(8482),c=a(7168),i=a(8145),n=a(9852),d=a(4616),m=a(4186),h=a(7809);let u=(0,a(9946).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var o=a(7924),x=a(1482),p=a(2657),j=a(3580),g=a(513),N=a(5784),v=a(6125),y=a(6052),b=a(5529),f=a(8376);let w=e=>{switch(e){case"pending_review":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-orange-100 text-orange-800";case"purchasing":return"bg-purple-100 text-purple-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};function A(){let[e,s]=(0,t.useState)(""),[a,A]=(0,t.useState)("all"),[C,_]=(0,t.useState)([]),[E,S]=(0,t.useState)({pending_review:0,purchasing:0,completed:0}),[R,L]=(0,t.useState)(!0),[k,z]=(0,t.useState)(!1),[q,P]=(0,t.useState)(null),{toast:T}=(0,j.dj)(),{trackPurchase:B,trackError:Z}=(0,g.s)(),{user:W}=(0,y.A)(),{t:I}=(0,b.c)(),{language:D}=(0,f.o)(),F=e=>{switch(e){case"pending_review":return I("purchases.statusLabels.pending_review","En Attente de R\xe9vision");case"confirmed":return I("purchases.statusLabels.confirmed","Confirm\xe9");case"purchasing":return I("purchases.statusLabels.purchasing","Achat en Cours");case"completed":return I("purchases.statusLabels.completed","Termin\xe9");case"cancelled":return I("purchases.statusLabels.cancelled","Annul\xe9");default:return e.replace("_"," ")}},H=async e=>{try{L(!0);let s=localStorage.getItem("authToken");if(!s){T({title:I("common.error","Erreur"),description:I("purchases.errors.sessionExpired","Session expir\xe9e, veuillez vous reconnecter"),variant:"destructive"});return}let[a,r]=await Promise.all([fetch("/api/purchase-requests".concat(e&&"all"!==e?"?status=".concat(e):""),{headers:{Authorization:"Bearer ".concat(s)}}),fetch("/api/purchase-requests/stats",{headers:{Authorization:"Bearer ".concat(s)}})]);if(!a.ok||!r.ok)throw Error("Failed to fetch data");let t=await a.json(),l=await r.json();_(Array.isArray(t)?t:[]),S(l)}catch(e){Z("API_ERROR",{error_message:e instanceof Error?e.message:"Unknown error",endpoint:"/api/purchase-requests"}),console.error("Error fetching data:",e),_([]),T({title:I("common.error","Erreur"),description:I("purchases.errors.loadError","Impossible de charger les donn\xe9es"),variant:"destructive"})}finally{L(!1)}};(0,t.useEffect)(()=>{H()},[T]),(0,t.useEffect)(()=>{R||(B("PURCHASE_FILTER",{filter_type:a}),H(a))},[a]);let $=C.filter(s=>{var a;return s.id.toLowerCase().includes(e.toLowerCase())||(null===(a=s.description)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase()))}),O=e=>{s(e),e&&B("PURCHASE_SEARCH",{search_query:e})},U=e=>{var s;return(null===(s=e.items)||void 0===s?void 0:s.reduce((e,s)=>e+(s.quantity||0),0))||0};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"lg:hidden",children:[(0,r.jsx)("div",{className:"flex justify-end mb-2",children:(0,r.jsx)(c.$,{size:"sm",asChild:!0,className:"h-7 text-sm",children:(0,r.jsxs)("a",{href:"/purchases/create",children:[(0,r.jsx)(d.A,{className:"w-3 h-3 mr-1"}),I("purchases.newRequestButton","Nouvelle Demande")]})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-semibold",children:I("purchases.title","Demandes d'Achat")}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:I("purchases.subtitle","G\xe9rez vos demandes d'achat et suivez leur progression")})]})]}),(0,r.jsxs)("div",{className:"hidden lg:flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-semibold",children:I("purchases.title","Demandes d'Achat")}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:I("purchases.subtitle","G\xe9rez vos demandes d'achat et suivez leur progression")})]}),(0,r.jsx)(c.$,{size:"sm",asChild:!0,className:"h-7 text-sm",children:(0,r.jsxs)("a",{href:"/purchases/create",children:[(0,r.jsx)(d.A,{className:"w-3 h-3 mr-1"}),I("purchases.newRequestButton","Nouvelle Demande")]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsx)(l.Zp,{className:"border-gray-200",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:I("purchases.stats.pendingReview","En Attente de R\xe9vision")}),(0,r.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:E.pending_review})]}),(0,r.jsx)("div",{className:"p-2 rounded-md bg-yellow-100",children:(0,r.jsx)(m.A,{className:"w-4 h-4 text-yellow-600"})})]})})}),(0,r.jsx)(l.Zp,{className:"border-gray-200",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:I("purchases.stats.inProgress","En Cours")}),(0,r.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:E.purchasing})]}),(0,r.jsx)("div",{className:"p-2 rounded-md bg-purple-100",children:(0,r.jsx)(h.A,{className:"w-4 h-4 text-purple-600"})})]})})}),(0,r.jsx)(l.Zp,{className:"border-gray-200",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:I("purchases.stats.completed","Termin\xe9")}),(0,r.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:E.completed})]}),(0,r.jsx)("div",{className:"p-2 rounded-md bg-green-100",children:(0,r.jsx)(u,{className:"w-4 h-4 text-green-600"})})]})})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,r.jsx)(o.A,{className:"absolute left-2 top-2 w-3 h-3 text-gray-400"}),(0,r.jsx)(n.p,{placeholder:I("purchases.searchPlaceholder","Rechercher des demandes..."),value:e,onChange:e=>O(e.target.value),className:"pl-7 h-8 text-sm"})]}),(0,r.jsxs)(N.l6,{value:a,onValueChange:A,children:[(0,r.jsxs)(N.bq,{className:"w-40 h-8 text-sm",children:[(0,r.jsx)(x.A,{className:"w-3 h-3 mr-1"}),(0,r.jsx)(N.yv,{placeholder:I("purchases.statusFilter","Statut")})]}),(0,r.jsxs)(N.gC,{children:[(0,r.jsx)(N.eb,{value:"all",className:"text-sm",children:I("purchases.allStatuses","Tous les Statuts")}),(0,r.jsx)(N.eb,{value:"pending_review",className:"text-sm",children:I("purchases.statusLabels.pending_review","En Attente de R\xe9vision")}),(0,r.jsx)(N.eb,{value:"pending_payment",className:"text-sm",children:I("purchases.statusLabels.pending_payment","En Attente de Paiement")}),(0,r.jsx)(N.eb,{value:"confirmed",className:"text-sm",children:I("purchases.statusLabels.confirmed","Confirm\xe9")}),(0,r.jsx)(N.eb,{value:"purchasing",className:"text-sm",children:I("purchases.statusLabels.purchasing","Achat en Cours")}),(0,r.jsx)(N.eb,{value:"completed",className:"text-sm",children:I("purchases.statusLabels.completed","Termin\xe9")})]})]})]}),R?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,r.jsx)(l.Zp,{className:"border-gray-200",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded mb-4"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded"})]}),(0,r.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,r.jsx)("div",{className:"h-7 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-7 bg-gray-200 rounded"})]})]})})},e))}):0===$.length?(0,r.jsxs)(l.Zp,{className:"border-gray-200",children:[(0,r.jsxs)(l.aR,{className:"text-center pb-4",children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("div",{className:"p-3 rounded-full bg-gray-100",children:(0,r.jsx)(h.A,{className:"w-8 h-8 text-gray-400"})})}),(0,r.jsx)(l.ZB,{className:"text-lg font-semibold text-gray-900",children:I("purchases.emptyState.title","Aucune demande trouv\xe9e")}),(0,r.jsx)(l.BT,{className:"text-sm text-gray-600",children:e||"all"!==a?I("purchases.emptyState.description","Aucune demande ne correspond \xe0 vos crit\xe8res de recherche."):I("purchases.emptyState.descriptionNoRequests","Vous n'avez pas encore de demandes d'achat. Commencez par cr\xe9er votre premi\xe8re demande.")})]}),(0,r.jsx)(l.Wu,{className:"text-center pt-0",children:!e&&"all"===a&&(0,r.jsx)(c.$,{asChild:!0,children:(0,r.jsxs)("a",{href:"/purchases/create",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 mr-2"}),I("purchases.emptyState.createFirstRequest","Cr\xe9er votre premi\xe8re demande")]})})})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(e=>(0,r.jsx)(l.Zp,{className:"border-gray-200 hover:shadow-sm transition-shadow",children:(0,r.jsxs)(l.Wu,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-medium text-gray-900",children:["#",e.id]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,r.jsx)(i.E,{className:w(e.status),children:F(e.status)})]}),(0,r.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:[I("purchases.total","Total"),":"]}),(0,r.jsx)("span",{className:"font-medium",children:(0,v.vv)(e.total_amount?Number(e.total_amount):null)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:[I("purchases.items","Items"),":"]}),(0,r.jsx)("span",{className:"font-medium",children:U(e)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:[I("purchases.created","Created"),":"]}),(0,r.jsx)("span",{className:"font-medium",children:(0,v.ER)(e.created_at,D)})]})]}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(c.$,{variant:"outline",size:"sm",className:"flex-1",asChild:!0,children:(0,r.jsxs)("a",{href:"/purchases/".concat(e.id),children:[(0,r.jsx)(p.A,{className:"w-3 h-1 mr-1"}),I("common.view","View")]})})})]})},e.id))})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9268,8229,7598,6911,8969,1072,6671,1142,1058,1600,3094,8441,1684,7358],()=>s(1390)),_N_E=e.O()}]);